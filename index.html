<!DOCTYPE html>
<html lang="et">
<head>
<meta charset="utf-8" />
    <!-- Responsive viewport: allow the page to extend into device cutouts and scale properly on small screens -->
    <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<meta name="color-scheme" content="dark light">
<meta name="theme-color" content="#0f1221" media="(prefers-color-scheme: dark)">
<meta name="theme-color" content="#ffffff" media="(prefers-color-scheme: light)">
<title>Rahakäsk – Kuu‑põhine eelarve + võlad</title>
    <!-- Preload main stylesheet for faster first paint -->
    <link rel="preload" as="style" href="styles.css">
    <link rel="stylesheet" href="styles.css">


</head>
<body>
<header class="appBar" data-sticky>
  <div class="appBar__brand">
    <h1>Rahakäsk • Kuu‑põhine eelarve + võlad</h1>
    <div class="appBar__meta">
      <span id="todayDate">—</span>
      <span class="summaryNote">Kuu alguses arhiveeritakse eelmise kuu seis automaatselt.</span>
    </div>
  </div>
  <div class="monthNav" role="group" aria-label="Kuu navigeerimine">
    <button class="btn ghost icon" id="prevMonth" type="button" aria-label="Eelmine kuu">‹</button>
    <span class="monthBadge" id="monthBadge" aria-live="polite">—</span>
    <button class="btn ghost icon" id="nextMonth" type="button" aria-label="Järgmine kuu">›</button>
  </div>
  <div class="appBar__actions">
    <button class="btn primary" id="expQuick" type="button">Lisa kulu</button>
    <button class="btn primary" id="adminAccessBtn" type="button">ADM</button>
  </div>
</header>

<main class="layout">
  <div class="sectionGrid">
    <button class="sectionButton" type="button" data-dialog-target="dlg-budget">
      <span class="sectionButton__label">Sissetulek ja püsikulud (kuu)</span>
      <span class="pill sectionButton__pill" data-pill="budget">—</span>
      <span class="sectionButton__hint">Vaata ja uuenda igakuised kohustused.</span>
    </button>
    <button class="sectionButton" type="button" data-dialog-target="dlg-summary">
      <span class="sectionButton__label">Jooksev kokkuvõte</span>
      <span class="sectionButton__hint">Kiire ülevaade valitud kuu seisu kohta.</span>
    </button>
    <button class="sectionButton" type="button" data-dialog-target="dlg-expenses">
      <span class="sectionButton__label">Selle kuu kulud</span>
      <span class="pill sectionButton__pill" data-pill="spent">Sel kuul: —</span>
      <span class="sectionButton__hint">Filtreeri ja halda kuu jooksul tehtud kulusid.</span>
    </button>
    <button class="sectionButton" type="button" data-dialog-target="dlg-archive">
      <span class="sectionButton__label">Arhiiv (varasemad kuud)</span>
      <span class="sectionButton__hint">Sirvi automaatselt salvestatud kuu kokkuvõtteid.</span>
    </button>
  </div>
</main>

<dialog id="dlg-budget" data-section-dialog aria-labelledby="dlg-budget-title">
  <div class="dialog-head">
    <h3 id="dlg-budget-title" style="margin:0">Sissetulek ja püsikulud (kuu)</h3>
    <button class="btn ghost icon" type="button" data-dialog-close aria-label="Sulge">✕</button>
  </div>
  <div class="dialog-body">
    <div class="sectionDialog__summary">
      <span class="pill" data-pill="budget">—</span>
      <p class="sectionDialog__hint">Jälgi sissetulekut ja püsikohustusi ning vaata, kui palju jääb alles.</p>
    </div>
    <div class="sectionDialog__scroll">
      <div class="card-body">
        <div class="fieldRow">
          <label for="income">Kuu netosissetulek</label>
          <div class="field currency">
            <input id="income" class="currency" type="text" inputmode="decimal" autocomplete="off" aria-errormessage="incomeErr">
            <p class="err" id="incomeErr" hidden role="alert"></p>
          </div>
        </div>
        <h3 class="helper">Püsikohustused</h3>
        <div class="fieldRow">
          <label for="loans">Laenud</label>
          <div class="field">
            <div class="payWrap">
              <div class="field currency" style="flex:1">
                <input id="loans" class="currency" type="text" inputmode="decimal" aria-errormessage="loansErr">
                <p class="err" id="loansErr" hidden role="alert"></p>
              </div>
              <button class="btn payToggle" type="button" data-key="loans" aria-pressed="false">Maksmata</button>
            </div>
          </div>
        </div>
        <div class="fieldRow">
          <label for="mom">Toetus emale</label>
          <div class="field">
            <div class="payWrap">
              <div class="field currency" style="flex:1">
                <input id="mom" class="currency" type="text" inputmode="decimal" aria-errormessage="momErr">
                <p class="err" id="momErr" hidden role="alert"></p>
              </div>
              <div class="field" style="min-width:160px">
                <input id="momEnd" type="date" aria-describedby="momEndHelp">
                <p class="helper" id="momEndHelp">Lõppkuupäev (k.a), kui kohustus lõpeb.</p>
              </div>
              <button class="btn payToggle" type="button" data-key="mom" aria-pressed="false">Maksmata</button>
            </div>
          </div>
        </div>
        <div class="fieldRow">
          <label for="aptSupport">Korteri tugi õele</label>
          <div class="field">
            <div class="payWrap">
              <div class="field currency" style="flex:1">
                <input id="aptSupport" class="currency" type="text" inputmode="decimal" aria-errormessage="aptSupportErr">
                <p class="err" id="aptSupportErr" hidden role="alert"></p>
              </div>
              <div class="field" style="min-width:160px">
                <input id="aptSupportEnd" type="date" aria-describedby="aptEndHelp">
                <p class="helper" id="aptEndHelp">Lõppkuupäev (k.a), kui tugi lõpeb.</p>
              </div>
              <button class="btn payToggle" type="button" data-key="aptSupport" aria-pressed="false">Maksmata</button>
            </div>
          </div>
        </div>
        <div class="fieldRow">
          <label for="phone">Telefon/Internet</label>
          <div class="field currency">
            <input id="phone" class="currency" type="text" inputmode="decimal" aria-errormessage="phoneErr">
            <p class="err" id="phoneErr" hidden role="alert"></p>
          </div>
        </div>
        <div class="fieldRow">
          <label for="transport">Transport</label>
          <div class="field currency">
            <input id="transport" class="currency" type="text" inputmode="decimal" aria-errormessage="transportErr">
            <p class="err" id="transportErr" hidden role="alert"></p>
          </div>
        </div>
        <div class="fieldRow">
          <label for="groceries">Toit</label>
          <div class="field currency">
            <input id="groceries" class="currency" type="text" inputmode="decimal" aria-errormessage="groceriesErr">
            <p class="err" id="groceriesErr" hidden role="alert"></p>
          </div>
        </div>
        <div class="fieldRow">
          <label for="otherEss">Muud esmavajadused</label>
          <div class="field currency">
            <input id="otherEss" class="currency" type="text" inputmode="decimal" aria-errormessage="otherEssErr">
            <p class="err" id="otherEssErr" hidden role="alert"></p>
          </div>
        </div>
        <h3 class="helper">Vaba valik</h3>
        <div class="fieldRow">
          <label for="fun">Meelelahutus</label>
          <div class="field currency">
            <input id="fun" class="currency" type="text" inputmode="decimal" aria-errormessage="funErr">
            <p class="err" id="funErr" hidden role="alert"></p>
          </div>
        </div>
        <div class="fieldRow">
          <label for="personal">Riided/Isiklik</label>
          <div class="field currency">
            <input id="personal" class="currency" type="text" inputmode="decimal" aria-errormessage="personalErr">
            <p class="err" id="personalErr" hidden role="alert"></p>
          </div>
        </div>
        <div class="fieldRow">
          <label for="zazaCap">Kanepi kulu ülempiir</label>
          <div class="field currency">
            <input id="zazaCap" class="currency" type="text" inputmode="decimal" aria-errormessage="zazaCapErr">
            <p class="err" id="zazaCapErr" hidden role="alert"></p>
          </div>
        </div>
        <h3 class="helper">Ohutus ja eesmärgid</h3>
        <div class="fieldRow">
          <label for="efTarget">Hädaabifondi siht</label>
          <div class="field currency">
            <input id="efTarget" class="currency" type="text" inputmode="decimal" aria-errormessage="efTargetErr">
            <p class="err" id="efTargetErr" hidden role="alert"></p>
          </div>
        </div>
        <div class="fieldRow">
          <label for="efNow">Hädaabifondi jääk</label>
          <div class="field currency">
            <input id="efNow" class="currency" type="text" inputmode="decimal" aria-errormessage="efNowErr">
            <p class="err" id="efNowErr" hidden role="alert"></p>
          </div>
        </div>
        <div class="fieldRow">
          <label for="paydaysInput">Palgapäev (nt 5 või 5,20)</label>
          <div class="field">
            <input id="paydaysInput" placeholder="Lisa päevad komaga eraldatult" aria-describedby="paydaysHelp">
            <p class="helper" id="paydaysHelp">Arvuta järgnevate maksepäevade vahe automaatselt.</p>
            <div class="helper" id="nextPayInfo"></div>
          </div>
        </div>
        <div class="kpi">
          <div class="box"><div class="label">Väljavool kokku</div><div class="val" id="kpiOut">—</div></div>
          <div class="box"><div class="label">Ülejääk / Puudujääk</div><div class="val" id="kpiLeft">—</div></div>
          <div class="box"><div class="label">Jaotus</div><div class="val" id="kpiAlloc">—</div></div>
        </div>
      </div>
    </div>
  </div>
</dialog>

<dialog id="dlg-summary" data-section-dialog aria-labelledby="dlg-summary-title">
  <div class="dialog-head">
    <h3 id="dlg-summary-title" style="margin:0">Jooksev kokkuvõte</h3>
    <button class="btn ghost icon" type="button" data-dialog-close aria-label="Sulge">✕</button>
  </div>
  <div class="dialog-body">
    <div class="sectionDialog__summary">
      <p class="sectionDialog__hint">Tabel ja jaotus peegeldavad valitud kuu seisu.</p>
    </div>
    <div class="sectionDialog__scroll">
      <div class="card-body">
        <div class="summaryList" id="liveSummary" aria-live="polite"></div>
        <p class="summaryNote">Tabel peegeldab valitud kuu seisu.</p>
        <section>
          <h3 style="font-size:.85rem;margin-top:.6rem">Kategooriate jälgimine</h3>
          <div class="breakdown" id="expBreakdown"></div>
        </section>
      </div>
    </div>
  </div>
</dialog>

<dialog id="dlg-zaza" data-section-dialog aria-labelledby="dlg-zaza-title">
  <div class="dialog-head">
    <h3 id="dlg-zaza-title" style="margin:0">Kanepi tegelikkuse kontroll</h3>
    <button class="btn ghost icon" type="button" data-dialog-close aria-label="Sulge">✕</button>
  </div>
  <div class="dialog-body">
    <div class="sectionDialog__summary">
      <span class="pill" data-pill="zaza">Zaza alles: —</span>
      <p class="sectionDialog__hint">Sisesta harjumused ja vajadusel kärbi kulusid.</p>
    </div>
    <div class="sectionDialog__scroll">
      <div class="card-body">
        <div class="fieldRow">
          <label for="pricePerGram">Hind €/g</label>
          <div class="field currency">
            <input id="pricePerGram" class="currency" type="text" inputmode="decimal" aria-errormessage="priceErr">
            <p class="err" id="priceErr" hidden role="alert"></p>
          </div>
        </div>
        <div class="fieldRow">
          <label for="gramsPerWeek">Gramme nädalas</label>
          <div class="field">
            <input id="gramsPerWeek" type="number" min="0" step="0.1">
          </div>
        </div>
        <div class="fieldRow">
          <label for="zazaAuto">Kuu kulu (auto)</label>
          <div class="field currency">
            <input id="zazaAuto" class="currency" type="text" inputmode="decimal" disabled>
          </div>
        </div>
        <div class="fieldRow">
          <label for="zazaCutPct">Vähenda (%)</label>
          <div class="field">
            <input id="zazaCutPct" type="number" min="0" max="100" step="1">
          </div>
        </div>
        <div class="fieldRow">
          <label aria-hidden="true"></label>
          <div class="field">
            <button class="btn" id="applyCap" type="button">Sea ülempiir ja liiguta sääst EF-i</button>
            <p class="helper" id="capMsg"></p>
            <div class="progress" aria-hidden="true"><div id="zazaProg"></div></div>
          </div>
        </div>
      </div>
    </div>
  </div>
</dialog>

<dialog id="dlg-expenses" data-section-dialog aria-labelledby="dlg-expenses-title">
  <div class="dialog-head">
    <h3 id="dlg-expenses-title" style="margin:0">Selle kuu kulud</h3>
    <button class="btn ghost icon" type="button" data-dialog-close aria-label="Sulge">✕</button>
  </div>
  <div class="dialog-body">
    <div class="sectionDialog__summary">
      <span class="pill" data-pill="spent">Sel kuul: —</span>
      <p class="sectionDialog__hint">Filtreeri kirjeid ja vaata kogusummat.</p>
    </div>
    <div class="sectionDialog__scroll">
      <div class="card-body" id="expSection">
        <div class="tableToolbar">
          <label for="expFilter">Filtreeri</label>
          <input id="expFilter" type="search" placeholder="Otsi kategooria või märkuse järgi">
        </div>
        <div class="tableWrap">
          <table id="expTbl" class="exp-table" aria-live="polite">
            <thead>
              <tr>
                <th><button type="button" data-sort="date">Kuupäev <span class="sortIcon" aria-hidden="true">⇅</span></button></th>
                <th>Kategooria</th>
                <th>Märkus</th>
                <th class="right"><button type="button" data-sort="amount">€ <span class="sortIcon" aria-hidden="true">⇅</span></button></th>
                <th aria-label="Tegevused"></th>
              </tr>
            </thead>
            <tbody></tbody>
            <tfoot>
              <tr><td colspan="3"><strong>Kokku (kuu):</strong></td><td class="right" id="expSum">0.00</td><td></td></tr>
            </tfoot>
          </table>
        </div>
      </div>
    </div>
  </div>
</dialog>

<dialog id="dlg-archive" data-section-dialog aria-labelledby="dlg-archive-title">
  <div class="dialog-head">
    <h3 id="dlg-archive-title" style="margin:0">Arhiiv (varasemad kuud)</h3>
    <button class="btn ghost icon" type="button" data-dialog-close aria-label="Sulge">✕</button>
  </div>
  <div class="dialog-body">
    <div class="sectionDialog__summary">
      <p class="sectionDialog__hint">Sirvi automaatselt salvestatud kuu kokkuvõtteid.</p>
    </div>
    <div class="sectionDialog__scroll">
      <div class="card-body">
        <div id="archivesList" class="summaryList"></div>
      </div>
    </div>
  </div>
</dialog>

<dialog id="expDialog" aria-label="Lisa kulu">
  <div class="dialog-head">
    <h3 style="margin:0">Lisa kulu</h3>
    <button class="btn ghost icon" id="closeExpDlg" type="button" aria-label="Sulge">✕</button>
  </div>
  <div class="dialog-body">
    <label for="expCat">Kategooria</label>
    <select id="expCat">
      <option>Zaza</option>
      <option>Telefon/Internet</option>
      <option>Toit</option>
      <option>Transport</option>
      <option>Meelelahutus</option>
      <option>Riided/Isiklik</option>
      <option>Muu</option>
    </select>
    <label for="expAmt">Summa (€)</label>
    <input id="expAmt" class="currency" type="text" inputmode="decimal" aria-errormessage="expAmtErr">
    <p class="err" id="expAmtErr" hidden role="alert"></p>
    <label for="expDate">Kuupäev</label>
    <input id="expDate" type="date">
    <label for="expNote">Märkus</label>
    <input id="expNote" type="text" placeholder="mis, kus, kelle jaoks">
  </div>
  <div class="dialog-actions">
    <button class="btn" id="cancelExp" type="button">Loobu</button>
    <button class="btn primary" id="addExp" type="button">+ Lisa kulu</button>
  </div>
</dialog>






<dialog id="adminMenuDialog" aria-labelledby="adminMenuTitle">
  <div class="dialog-head">
    <h3 id="adminMenuTitle" style="margin:0">Administraatori menüü</h3>
    <button class="btn ghost icon" type="button" data-dialog-close aria-label="Sulge">✕</button>
  </div>
  <div class="dialog-body adminMenu">
    <section class="adminMenu__view" id="adminLockView" aria-live="polite">
      <p class="adminMenu__hint">Kanepi tegelikkuse kontroll on ainult administraatoritele. Sisesta parool, et avada menüü.</p>
      <label class="adminMenu__label" for="adminPasswordInput">Parool</label>
      <input id="adminPasswordInput" type="password" autocomplete="current-password" spellcheck="false" aria-describedby="adminPasswordError">
      <p class="err" id="adminPasswordError" hidden role="alert">Vale parool. Proovi uuesti.</p>
      <div class="adminMenu__actions">
        <button class="btn primary" type="button" id="adminPasswordSubmit">Ava menüü</button>
      </div>
    </section>
    <section class="adminMenu__view" id="adminActionView" hidden>
      <p class="adminMenu__hint">Vali soovitud administraatori toiming.</p>
      <div class="adminMenu__actions">
        <button class="btn primary adminMenu__action" type="button" data-admin-action="zaza">Kanepi tegelikkuse kontroll</button>
      </div>
    </section>
  </div>
</dialog>

<script src="app.js" defer></script>
</body>
</html>

